ã„ã„ã§ã™ã­ã€ã˜ã‚ƒã‚ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã ã‘ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ã€
ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«/Auth ã¨åŒã˜ãƒãƒªã§ ä»•æ§˜ã‚’ã‚¬ãƒƒãƒãƒªå›ºã‚ã¦ã„ãã¾ã™ ğŸ’ª

ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ©Ÿèƒ½ã®ä»•æ§˜ 0. æ¦‚è¦
ç›®çš„

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ã€Œ1 æ—¥ã‚ãŸã‚Šã®æ „é¤Šç›®æ¨™ï¼ˆ17 æ „é¤Šç´ ãªã©ï¼‰ã€ã‚’å®šç¾©ãƒ»ç®¡ç†ã™ã‚‹ã€‚
å½“æ—¥ã¯ â€œä»Šã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ¼ã‚²ãƒƒãƒˆâ€ ã‚’ä½¿ã†ã€‚
éå»æ—¥ã¯ â€œãã®æ—¥å½“æ™‚ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’å›ºå®šåŒ–ã—ãŸã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆâ€ ã‚’ä½¿ã†ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€

æ—¥ã€…ã®æ „é¤Šè©•ä¾¡ï¼ˆå®Ÿç¸¾ vs ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼‰
æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ / ææ¡ˆ / ãƒãƒƒã‚¸ ãªã©
ã® åŸºæº–å€¤ ã‚’æä¾›ã™ã‚‹ã®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ©Ÿèƒ½ã®å½¹å‰²ã€‚

1. ãƒ‡ãƒ¼ã‚¿ä»•æ§˜ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
   1-1. TargetDefinitionï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆå®šç¾©ï¼‰
   1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Šæœ€å¤§ 5 ä»¶ã¾ã§ã€‚å¸¸ã« 1 ä»¶ã ã‘ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã€‚

ä¸»ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰
TargetDefinition(
id: TargetId,
user_id: UserId,

    name: str,              # ã€Œæ¸›é‡ç”¨ã€ã€Œç­‹ãƒˆãƒ¬æœŸé–“ç”¨ã€ãªã©ã®åå‰
    goal_type: GoalType,    # lose_weight / maintain / gain_muscle etc.
    activity_level: ActivityLevel,  # low / medium / high

    nutrients: list[TargetNutrient],  # 17æ „é¤Šç´ åˆ†ã®ç›®æ¨™å€¤

    is_active: bool,        # ã“ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‹
    created_at: datetime,
    updated_at: datetime,

)
TargetNutrient:

code: NutrientCodeï¼ˆä¾‹: energy, protein, fat, carb, vitamin_c â€¦ï¼‰
amount: NutrientAmountï¼ˆvalue + unitï¼‰
source: NutrientSourceï¼ˆä¾‹: "llm", "manual"ï¼‰
åˆ¶ç´„
1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¤ã TargetDefinition ã¯ æœ€å¤§ 5 ä»¶ã€‚

1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¤ã is_active == True ã¯ å¸¸ã« 1 ä»¶ã€‚

æ–°è¦ä½œæˆæ™‚ï¼š

ä¸Šé™æœªæº€ï¼ˆ5 ä»¶æœªæº€ï¼‰ã®å ´åˆã®ã¿ä½œæˆå¯
ã€Œæ–°è¦ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹ã€å ´åˆã€æ—¢å­˜ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
nutrients ã¯å¿…ãšã€Œã‚¢ãƒ—ãƒªã§æ‰±ã† 17 æ „é¤Šç´ ã¶ã‚“ã€ãŒå…¥ã£ã¦ã„ã‚‹æƒ³å®š
ï¼ˆä¸è¶³ã‚„é‡è¤‡ãŒã‚ã‚‹å ´åˆã¯ UC å´ã‹ãƒ‰ãƒ¡ã‚¤ãƒ³å´ã§è£œæ­£/ã‚¨ãƒ©ãƒ¼ï¼‰

1-2. DailyTargetSnapshotï¼ˆæ—¥æ¬¡ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼‰
ã€Œã‚ã‚‹æ—¥ä»˜ã«ã¨ã£ã¦ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤ã‚’å›ºå®šåŒ–ã—ãŸã‚‚ã®ã€ã€‚

DailyTargetSnapshot(
id: DailyTargetSnapshotId,
user_id: UserId,
date: date, # ã“ã®æ—¥ä»˜ã®ãŸã‚ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ

    base_target_id: TargetId,         # ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆåŒ–ã—ãŸå…ƒã® TargetDefinition ã® ID
    nutrients: list[TargetNutrient],  # ãã®æ™‚ç‚¹ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤

    created_at: datetime,

)
åˆ¶ç´„
(user_id, date) ã«å¯¾ã—ã¦ æœ€å¤§ 1 ä»¶ã€‚
ä¸€åº¦ä½œã‚‰ã‚ŒãŸ Snapshot ã® nutrients ã¯ å¤‰æ›´ä¸å¯ï¼ˆimmutableï¼‰ã€‚
Snapshot ã¯åŸºæœ¬çš„ã« JOB ã‹ã‚‰ã®ã¿ä½œæˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç›´æ¥ã„ã˜ã‚‰ãªã„ï¼‰ã€‚
1-3. LLM é–¢é€£ VO / Enum
GoalTypeï¼šlose_weight, maintain, gain_muscle, recovery â€¦ï¼ˆç”¨é€”ã«å¿œã˜ã¦æ‹¡å¼µï¼‰

ActivityLevelï¼šlow, medium, high

NutrientCodeï¼šenergy, protein, fat, carb, fiber, vitamin_c, â€¦ ãªã© 17 æ „é¤Šç´ 

NutrientAmountï¼š

value: float
unit: strï¼ˆä¾‹ "kcal", "g", "mg", "Âµg"ï¼‰
NutrientSourceï¼š

"llm"ï¼šLLM ã«ã‚ˆã‚‹è‡ªå‹•ç”Ÿæˆ
"manual"ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹æ‰‹å‹•å¤‰æ›´ 2. å¤–éƒ¨ä»•æ§˜ï¼ˆUX / API è¦–ç‚¹ï¼‰
2-1. åˆ©ç”¨è€…ã¨å‰æ
æ“ä½œä¸»ä½“ï¼šãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€‚

èªå¯ï¼š

è‡ªåˆ†ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ã¿æ“ä½œå¯èƒ½ã€‚
ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ã€‚
2-2. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼ˆUX ãƒ¬ãƒ™ãƒ«ï¼‰
åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆæ€§åˆ¥/èº«é•·/ä½“é‡/meals_per_dayï¼‰ã‚’å…¥åŠ›ã€‚
ã€Œç›®æ¨™ï¼ˆæ¸›é‡ãƒ»ç¶­æŒãƒ»å¢—é‡ãªã©ï¼‰ã€ã¨ã€Œæ´»å‹•ãƒ¬ãƒ™ãƒ«ã€ã‚’é¸æŠã€‚
â†’ LLM ã«ã‚ˆã£ã¦ 1 ã¤ç›®ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå®šç¾©ãŒç”Ÿæˆã•ã‚Œã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã¨ã—ã¦è¨­å®šã•ã‚Œã‚‹ã€‚
ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’è¿½åŠ ã§ä½œæˆ

æ—¢ã«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒã‚ã‚‹çŠ¶æ…‹ã§ã€æ–°ã—ã„ç›®æ¨™ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç™»éŒ²ã—ãŸã„ã€‚
LLM ã«ã‚ˆã‚‹ã€Œåˆ¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã€ã‚’è¿½åŠ ï¼ˆæœ€å¤§ 5 ä»¶ã¾ã§ï¼‰ã€‚
å¿…è¦ã«å¿œã˜ã¦ã€æ–°ã—ã„ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚
ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®éƒ¨åˆ†å¤‰æ›´ï¼ˆæ‰‹å‹•ï¼‰

ã™ã§ã«ç”Ÿæˆã•ã‚ŒãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®æ „é¤Šå€¤ã‚’å°‘ã—èª¿æ•´ã—ãŸã„ã€‚
ä¾‹ï¼šãŸã‚“ã±ãè³ª +10g, ã‚«ãƒ­ãƒªãƒ¼ -200kcal ãªã©ã€‚
ã“ã®å¤‰æ›´ã¯ æ‰‹å‹•ç·¨é›†ã®ã¿æœ‰åŠ¹ã€‚LLM ã«ã‚ˆã‚‹å·®åˆ†æ›´æ–°ã¯è¡Œã‚ãªã„ã€‚
ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®åˆ‡ã‚Šæ›¿ãˆ

ã‚¿ãƒ¼ã‚²ãƒƒãƒˆä¸€è¦§ã‹ã‚‰åˆ¥ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹ã€‚
ã€Œæ¸›é‡ãƒ•ã‚§ãƒ¼ã‚º â†’ ç¶­æŒãƒ•ã‚§ãƒ¼ã‚ºã€ãªã©ã®åˆ‡ã‚Šæ›¿ãˆã€‚
ã‚¿ãƒ¼ã‚²ãƒƒãƒˆä¸€è¦§ãƒ»è©³ç´°ã®å‚ç…§

UI ä¸Šã§ã€è‡ªåˆ†ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆä¸€è¦§ã‚’é–²è¦§ã€‚
ãã‚Œãã‚Œã®åå‰, ç›®æ¨™, æ´»å‹•ãƒ¬ãƒ™ãƒ«, æ „é¤Šä¸€è¦§ã‚’è¡¨ç¤ºã€‚
éå»æ—¥ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå‚ç…§

æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚„ã‚°ãƒ©ãƒ•ç”»é¢ã§ã€Œãã®æ—¥ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤ã€ã‚’è¦‹ãŸã„ã€‚
éå»æ—¥ã¯ DailyTargetSnapshot ã‹ã‚‰èª­ã¿å‡ºã™ã€‚
2-3. API ä»•æ§˜ï¼ˆå¤–éƒ¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰
(1) GET /targets
ç›®çš„ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå®šç¾©ä¸€è¦§ã‚’å–å¾—ã€‚
ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ï¼š
{
"items": [
{
"id": "target-uuid-1",
"name": "æ¸›é‡æœŸï¼ˆæ˜¥ï¼‰",
"goal_type": "lose_weight",
"activity_level": "medium",
"is_active": true,
"created_at": "2025-01-10T12:00:00Z",
"nutrients": [
{ "code": "energy", "value": 1800, "unit": "kcal" },
{ "code": "protein", "value": 120, "unit": "g" },
...
]
},
...
]
}
(2) GET /targets/active
ç›®çš„ï¼šç¾åœ¨ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’å–å¾—ã€‚
ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼šä¸Šè¨˜ã‚¢ã‚¤ãƒ†ãƒ ã®ã†ã¡ 1 ä»¶ï¼ˆis_active == trueï¼‰ã€‚
(3) POST /targetsï¼ˆLLM ã«ã‚ˆã‚‹æ–°è¦ä½œæˆï¼‰
ç›®çš„ï¼šæ–°ã—ã„ TargetDefinition ã‚’ LLM ã§ç”Ÿæˆã€‚

åˆ¶ç´„ï¼š

æ—¢ã« 5 ä»¶ã‚ã‚‹å ´åˆ â†’ 400 or 409ï¼ˆä¸Šé™è¶…éã‚¨ãƒ©ãƒ¼ï¼‰ã€‚
ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹ï¼š

{
"name": "å¢—é‡æœŸï¼ˆå†¬ï¼‰",
"goal_type": "gain_muscle",
"activity_level": "high"
}
ãƒ•ãƒ­ãƒ¼ï¼š

Profile å–å¾—ï¼ˆãªã‘ã‚Œã°ã‚¨ãƒ©ãƒ¼ï¼‰
æ—¢å­˜ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ•°ãƒã‚§ãƒƒã‚¯ï¼ˆ5 ä»¶ä»¥ä¸Šãªã‚‰ã‚¨ãƒ©ãƒ¼ï¼‰
LLM ã« Profile + goal_type + activity_level ã‚’æ¸¡ã—ã¦æ „é¤Šã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”Ÿæˆ
TargetDefinition ã¨ã—ã¦ä¿å­˜
ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼šactivate=true ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚Œã°ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼š

ä½œæˆã•ã‚ŒãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆå®šç¾©ï¼ˆ+ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‹ã©ã†ã‹ï¼‰
(4) PATCH /targets/{target_id}ï¼ˆæ‰‹å‹•ã®éƒ¨åˆ†å¤‰æ›´ï¼‰
ç›®çš„ï¼šæ—¢å­˜ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®æ „é¤Šå€¤ã‚’æ‰‹å‹•ã§å¾®èª¿æ•´ã€‚

å‰æï¼š

LLM ã‚’ä½¿ã‚ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å€¤ã‚’ãã®ã¾ã¾åæ˜ ã€‚
ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹ï¼š

{
"nutrients": [
{ "code": "protein", "value": 130, "unit": "g" },
{ "code": "energy", "value": 1900, "unit": "kcal" }
]
}
æŒ¯ã‚‹èˆã„ï¼š

æŒ‡å®šã•ã‚ŒãŸæ „é¤Šç´ ã‚³ãƒ¼ãƒ‰ã®å€¤ã®ã¿ä¸Šæ›¸ãã€‚
LLM ç”±æ¥ã‹ã©ã†ã‹ã«é–¢ä¿‚ãªã source = "manual" ã¨ã—ã¦æ‰±ã†ã“ã¨ã‚‚å¯èƒ½ã€‚
(5) POST /targets/{target_id}/activate
ç›®çš„ï¼šæŒ‡å®šã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹ã€‚

æŒ¯ã‚‹èˆã„ï¼š

ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä»–ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ is_active ã‚’ã™ã¹ã¦ False ã«ã™ã‚‹ã€‚
æŒ‡å®š target_id ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ã¿ is_active = True ã«ã™ã‚‹ã€‚
(6) éå»æ—¥ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®å‚ç…§
åŸºæœ¬çš„ã«ã¯ å†…éƒ¨ä»•æ§˜ã§ Snapshot ã‚’ä½¿ã£ã¦è¨ˆç®—ã™ã‚‹æƒ³å®šãªã®ã§ã€
å¤–éƒ¨ API ã¨ã—ã¦å¿…é ˆã§ã¯ãªã„ãŒã€å°†æ¥ç”¨ã«ï¼š

GET /targets/daily?date=YYYY-MM-DD

å½“æ—¥ â†’ Active Target ã«åŸºã¥ãå€¤
éå»æ—¥ â†’ Snapshot ã® nutrients
ã‚’è¿”ã™ API ã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã€‚

3. å†…éƒ¨ä»•æ§˜ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ / UseCase / Repo / JOBï¼‰
   3-1. ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼ˆapp/domain/targetï¼‰
   TargetDefinition

TargetNutrient

DailyTargetSnapshot

ValueObjects:

GoalType, ActivityLevel, NutrientCode, NutrientAmount, NutrientSource
ã‚¨ãƒ©ãƒ¼ï¼š

TargetNotFoundError
ActiveTargetNotFoundError
TargetLimitExceededErrorï¼ˆ5 ä»¶è¶…éï¼‰
NoActiveTargetForSnapshotErrorï¼ˆJOB å®Ÿè¡Œæ™‚ãªã©ï¼‰
ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¬ãƒ™ãƒ«ã®ä¸å¤‰æ¡ä»¶ï¼ˆInvariantsï¼‰ï¼š

1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Š TargetDefinition ã¯ 5 ä»¶ã¾ã§
â†’ ãã‚Œä»¥ä¸Šã¯ä½œã‚Œãªã„ã€‚
1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Š is*active=True ã¯å¸¸ã« 1 ä»¶ï¼ˆã¾ãŸã¯ 0 ä»¶ã¯è¨±å®¹ã™ã‚‹ã‹ã©ã†ã‹ã‚’æ±ºã‚ã‚‹ï¼‰ã€‚
DailyTargetSnapshot ã® nutrients ã¯ç”Ÿæˆå¾Œå¤‰æ›´ã—ãªã„ï¼ˆimmutableï¼‰ã€‚
3-2. Application Ports
TargetRepositoryPort
class TargetRepositoryPort(Protocol):
def list_by_user(self, user_id: UserId) -> list[TargetDefinition]: ...
def get_by_id(self, target_id: TargetId) -> TargetDefinition | None: ...
def get_active_for_user(self, user_id: UserId) -> TargetDefinition | None: ...
def save(self, target: TargetDefinition) -> None: ...
DailyTargetSnapshotRepositoryPort
class DailyTargetSnapshotRepositoryPort(Protocol):
def get_by_user_and_date(self, user_id: UserId, date*: date) -> DailyTargetSnapshot | None: ...
def save(self, snapshot: DailyTargetSnapshot) -> None: ...
TargetGeneratorPortï¼ˆLLM ç”¨ï¼‰
class TargetGeneratorPort(Protocol):
def generate(
self,
profile: Profile,
goal_type: GoalType,
activity_level: ActivityLevel,
) -> list[TargetNutrient]:
...
3-3. UseCase ä¸€è¦§ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼‰
CreateTargetUseCaseï¼ˆLLM æ–°è¦ç”Ÿæˆï¼‰
ListTargetsUseCase
GetTargetUseCase
UpdateTargetUseCaseï¼ˆæ‰‹å‹•éƒ¨åˆ†å¤‰æ›´ï¼‰
ActivateTargetUseCaseï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–åˆ‡ã‚Šæ›¿ãˆï¼‰
EnsureDailyTargetSnapshotUseCaseï¼ˆã€Œã‚ã‚‹æ—¥ã«å¯¾ã—ã¦ Snapshot ã‚’å¿…ãšç”¨æ„ã™ã‚‹ã€ï¼‰
SnapshotActiveTargetForYesterdayJobUseCaseï¼ˆJOB å†…éƒ¨ã§ä½¿ã†ã€ã‚ˆã‚Šãƒãƒƒãƒå¯„ã‚Šï¼‰
3-4. å„ UseCase ã®ä»•æ§˜ï¼ˆã–ã£ãã‚Šï¼‰
CreateTargetUseCase
å…¥åŠ›ï¼šgoal_type, activity_level, nameï¼ˆä»»æ„ï¼‰

å‡¦ç†ï¼š

Profile å–å¾—ï¼ˆãªã‘ã‚Œã°ã‚¨ãƒ©ãƒ¼ï¼‰
æ—¢å­˜ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ•°ãƒã‚§ãƒƒã‚¯ï¼ˆ5 ä»¶ä»¥ä¸Š â†’ TargetLimitExceededErrorï¼‰
TargetGeneratorPort ã§ nutrients ã‚’ç”Ÿæˆ
TargetDefinition ã‚’ä½œæˆãƒ»ä¿å­˜
ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ï¼ˆå¼•æ•°ã§æŒ‡å®šï¼‰
UpdateTargetUseCaseï¼ˆæ‰‹å‹•éƒ¨åˆ†å¤‰æ›´ï¼‰
å…¥åŠ›ï¼štarget_id, nutrients ã®å¤‰æ›´å†…å®¹

å‡¦ç†ï¼š

target ã‚’å–å¾—ï¼ˆãªã‘ã‚Œã°ã‚¨ãƒ©ãƒ¼ï¼‰
æŒ‡å®šã•ã‚ŒãŸ nutrient code ã® amount ã‚’ä¸Šæ›¸ã
source = "manual" ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã‹ã¯ãƒãƒªã‚·ãƒ¼æ¬¡ç¬¬
ä¿å­˜
ActivateTargetUseCase
å…¥åŠ›ï¼štarget_id

å‡¦ç†ï¼š

target ã‚’å–å¾—ï¼ˆãªã‘ã‚Œã°ã‚¨ãƒ©ãƒ¼ï¼‰
åŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä»–ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã® is_active = False ã«å¤‰æ›´
æŒ‡å®šã‚¿ãƒ¼ã‚²ãƒƒãƒˆ is_active = True ã«å¤‰æ›´
ä¿å­˜
EnsureDailyTargetSnapshotUseCase
å…¥åŠ›ï¼šuser_id, date

å‡¦ç†ï¼š

SnapshotRepo ã§æ—¢ã« (user_id, date) ãŒã‚ã‚‹ã‹ç¢ºèª â†’ ã‚ã‚Œã°ãã‚Œã‚’è¿”ã™

ãªã‘ã‚Œã° TargetRepositoryPort.get_active_for_user ã§ Active Target ã‚’å–å¾—

ãªã‘ã‚Œã° ActiveTargetNotFoundError
Active Target ã‹ã‚‰ DailyTargetSnapshot ã‚’ç”Ÿæˆ

ä¿å­˜ã—ã¦è¿”ã™

SnapshotActiveTargetForYesterdayJobUseCaseï¼ˆJOB ç”¨ï¼‰
å…¥åŠ›ï¼šdate_todayï¼ˆã‚¸ãƒ§ãƒ–å®Ÿè¡Œæ™‚ã®ã€Œä»Šæ—¥ã€ï¼‰

å‡¦ç†ï¼š

date_yesterday = date_today - 1 æ—¥

å…¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’å–å¾—ï¼ˆUserRepositoryPortï¼‰

å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¤ã„ã¦ï¼š

EnsureDailyTargetSnapshotUseCase.execute(user, date_yesterday) ã‚’å‘¼ã¶
ï¼ˆActive ãŒãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼ or ãƒ­ã‚°ã—ã¦ã‚¹ã‚­ãƒƒãƒ—ï¼‰ 4. ã¾ã¨ã‚ï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆä»•æ§˜ã®ã‚­ãƒ¢ï¼‰
TargetDefinition
â†’ ã€Œä»Šå¾Œã©ã†ã„ã†æ „é¤Šã‚’ç›®æŒ‡ã™ã‹ã€ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æœ€å¤§ 5 ä»¶ã¾ã§æŒã¦ã‚‹ã€‚
â†’ æ–°è¦ã®ä½œæˆã¯ LLM ã§ã€éƒ¨åˆ†å¤‰æ›´ã¯æ‰‹å‹•ã®ã¿ã€‚

Active Target
â†’ ã€Œä»Šæ—¥ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã€ã¯å¸¸ã«ã“ã® 1 ã¤ã‹ã‚‰å‚ç…§ã€‚

DailyTargetSnapshot
â†’ ã€Œæ˜¨æ—¥ä»¥å‰ã€ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤ã¯ã€ãã®å½“æ™‚ã® Active Target ã‚’å›ºå®šåŒ–ã—ãŸã‚‚ã®ã€‚
â†’ æ—¥ã‚’è·¨ã JOB ã§è‡ªå‹•ç”Ÿæˆã—ã€å¾Œã‹ã‚‰å¤‰ãˆãªã„ã€‚

ä»–æ©Ÿèƒ½ï¼ˆæ „é¤Šè¨ˆç®— / ãƒ¬ãƒãƒ¼ãƒˆ / ææ¡ˆï¼‰
â†’ å¯¾è±¡æ—¥ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå‚ç…§ãƒ­ã‚¸ãƒƒã‚¯ã¯ä¸€è²«ã—ã¦ï¼š

éå»æ—¥ â†’ DailyTargetSnapshot
å½“æ—¥ â†’ Active Target
ã¨ã„ã†å½¢ã§ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ©Ÿèƒ½ãŒã€Œæ „é¤Šè©•ä¾¡ã®åŸºæº–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã€ã‚’æä¾›ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ ğŸ’¡

ã“ã®ä»•æ§˜ã‚’å‰æã«ã€æ¬¡ã¯ã€Œè¨˜éŒ²å®Œäº†åˆ¤å®šã€ã‚„ã€Œæ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã€ã€Œææ¡ˆã€ã‚’ã•ã‚‰ã«åŒã˜ãƒãƒªã§æ˜ã£ã¦ã„ãã€ã¨ã„ã†æµã‚Œã§é€²ã‚ã‚‰ã‚Œã¾ã™ã€‚
