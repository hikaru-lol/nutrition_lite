---
description: 'フロントエンドBFF: Next.js Route Handlersプロキシルール (params/cookies/set-cookie)'
globs:
  [
    'frontend/src/app/api/**/*.{ts,tsx}',
    'frontend/src/shared/api/**/*.{ts,tsx}',
  ]
alwaysApply: false
---

# BFFルール (Next.js app/api)

## プロキシ境界

- フロントエンドは直接バックエンドを呼び出さない。`/api/*` (BFF)を呼び出す。
- BFFはバックエンド `/api/v1/*` にプロキシ。

## Route Handler paramsの落とし穴

- paramsを非同期の可能性ありとして扱う:
  - 常に `const params = await ctx.params` (または同等品)
  - メソッド間 (GET/POST等) で一貫性を保つ

## Cookie

- リクエストcookieをバックエンドに転送 (`cookie`ヘッダー送信)。
- バックエンドの`set-cookie`をクライアントに転送。
- 複数の`set-cookie`ヘッダーをサポート。

## エラー

- バックエンドエラーを隠さない。
- 安全な場合はステータス + ペイロードのパススルーを優先。
- `frontend/src/shared/api/*`でエラーを正規化 (unknown → 型付き/アプリエラー)。
