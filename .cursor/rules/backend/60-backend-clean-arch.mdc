---
description: 'バックエンド: クリーンアーキテクチャ境界 + ポート&アダプターの規律'
globs: ['backend/**/*']
alwaysApply: false
---

# バックエンドルール (クリーンアーキテクチャ)

## レイヤリング (絶対に破らない)

API (FastAPIルーター, DI)
→ Application (ユースケース, DTO, ポート)
→ Domain (エンティティ, 値オブジェクト, ドメインエラー)
→ Infrastructure (DB/LLM/ストレージ/セキュリティアダプター)

## ルール

- Domainは外部I/Oフレームワーク (FastAPI/DBクライアント等) に依存しない。
- Applicationはポート (インターフェース) に依存し、具体的なインフラには依存しない。
- Infraはポートを実装。APIはDIコンテナ経由で依存性を結線。

## 変更

- 最小差分。無関係なリファクタリングはしない。
- 動作変更の際: 影響を受けるユースケースを特定 + テストの追加/更新。
