ã„ã„ã§ã™ã­ã€æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã¯ã“ã®ã‚¢ãƒ—ãƒªã®ã€Œæ¥½ã—ã•ãƒ»ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã€ã®æ ¸ãªã®ã§ã€ã“ã“ã‚’ã¡ã‚ƒã‚“ã¨å›ºã‚ã¦ãŠãã®ã¯ã‹ãªã‚Šå¤§äº‹ã§ã™ ğŸ’ª
ã“ã‚Œã¾ã§ã¨åŒã˜ãï¼š

æ¦‚è¦
ãƒ‡ãƒ¼ã‚¿ä»•æ§˜ï¼ˆä½•ã‚’æŒã¤ã‹ï¼‰
å¤–éƒ¨ä»•æ§˜ï¼ˆUX / APIï¼‰
å†…éƒ¨ä»•æ§˜ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ / UseCase / ãƒãƒ¼ãƒˆï¼‰
ã®é †ã§æ•´ç†ã—ã¾ã™ã€‚

æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆï¼ˆDailyNutritionReportï¼‰ã®ä»•æ§˜ 0. æ¦‚è¦
ç›®çš„

1 æ—¥ã®é£Ÿäº‹ã¨æ „é¤ŠçŠ¶æ…‹ã‚’ã€Œè¨€è‘‰ã€ã§æŒ¯ã‚Šè¿”ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
ã€Œè‰¯ã‹ã£ãŸç‚¹ã€ã€Œæ”¹å–„ãƒã‚¤ãƒ³ãƒˆã€ã€Œæ˜æ—¥ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã€ã¨ã„ã£ãŸ è¡Œå‹•ã«ã¤ãªãŒã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ ã‚’ LLM ã§ç”Ÿæˆãƒ»ä¿å­˜ã™ã‚‹ã€‚
ä½ç½®ã¥ã‘

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ã®ä¸­ã§ã¯ï¼š
é£Ÿäº‹è¨˜éŒ²ï¼ˆFoodEntryï¼‰
â†’ æ „é¤Šè¨ˆç®—ï¼ˆMeal / Dailyï¼‰
â†’ è¨˜éŒ²å®Œäº†åˆ¤å®š
â†’ æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆï¼ˆã“ã®ä»•æ§˜ï¼‰
â†’ ææ¡ˆï¼ˆRecommendationï¼‰

ã® 4 æ®µç›®ã€‚

ãƒ—ãƒ©ãƒ³åˆ¶ç´„

ã€Œæ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã®ä½œæˆã€ã¯ TRIAL / PAID ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿åˆ©ç”¨å¯èƒ½ã€‚

FREE ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ï¼š

TRIAL / PAID æœŸé–“ä¸­ã«ç”Ÿæˆã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆã®é–²è¦§ã¯ã§ãã‚‹æƒ³å®šã ãŒã€
æ–°è¦ãƒ¬ãƒãƒ¼ãƒˆã®ä½œæˆã¯ä¸å¯ã€‚

1. ãƒ‡ãƒ¼ã‚¿ä»•æ§˜ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³è¦–ç‚¹ï¼‰
   1-1. DailyNutritionReport ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
   1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ Ã— 1 æ—¥ã‚ãŸã‚Šæœ€å¤§ 1 ä»¶ã€‚

DailyNutritionReport(
id: DailyNutritionReportId,
user_id: UserId,
date: date, # ã“ã®ãƒ¬ãƒãƒ¼ãƒˆãŒå¯¾è±¡ã¨ã™ã‚‹æ—¥

    summary: str,         # 1 æ—¥å…¨ä½“ã®ç·è©•ï¼ˆæœ¬æ–‡ï¼‰

    good_points: list[str],         # è‰¯ã‹ã£ãŸç‚¹
    improvement_points: list[str],  # æ”¹å–„ã§ããã†ãªç‚¹
    tomorrow_focus: list[str],      # æ˜æ—¥æ„è­˜ã—ãŸã„ã“ã¨ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

    created_at: datetime,

)
1-2. åˆ¶ç´„
(user_id, date) ã§ é«˜ã€… 1 ä»¶ã€‚
ä¸€åº¦ç”Ÿæˆã—ãŸãƒ¬ãƒãƒ¼ãƒˆã¯ã€Œãã®æ™‚ç‚¹ã®æŒ¯ã‚Šè¿”ã‚Šã€ã¨ã—ã¦åŸºæœ¬çš„ã«ã¯ä¸Šæ›¸ãã—ãªã„ï¼ˆå†ç”Ÿæˆãƒãƒªã‚·ãƒ¼ãŒå¿…è¦ãªã‚‰åˆ¥é€”ï¼‰ã€‚
ãƒ¬ãƒãƒ¼ãƒˆã¯ ã€Œãã®æ™‚ç‚¹ã¾ã§ã«å­˜åœ¨ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ»æ „é¤ŠçŠ¶æ…‹ï¼‰ã€ã«åŸºã¥ãã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ ã¨ã—ã¦æ‰±ã†ã€‚
1-3. ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã®ææ–™ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³çš„å…¥åŠ›ï¼‰
æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œã‚‹ãŸã‚ã«ã¯ã€æœ€ä½é™ä»¥ä¸‹ãŒæƒã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼š

Profileï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼‰

å¯¾è±¡æ—¥ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼š

éå»æ—¥ â†’ DailyTargetSnapshot
å½“æ—¥ â†’ Active Target
DailyNutritionSummaryï¼ˆæ•°å­—ã¨ã—ã¦ã®å®Ÿç¸¾ï¼‰

ãã®æ—¥ã® MealNutritionSummary ä¸€è¦§ï¼ˆé£Ÿäº‹ã”ã¨ã®æ „é¤Šï¼‰

ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰ç›´è¿‘æ•°æ—¥ã®å‚¾å‘ã‚’è¿½åŠ ã—ã¦ã‚‚è‰¯ã„ãŒã€**åŸºæœ¬ã¯ã€Œãã®æ—¥ 1 æ—¥åˆ†ã€**ãŒå¯¾è±¡

2. å¤–éƒ¨ä»•æ§˜ï¼ˆUX / API è¦–ç‚¹ï¼‰
   2-1. èª°ãŒãƒ»ã„ã¤ä½¿ã†ã‹
   æ“ä½œä¸»ä½“ï¼šãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ + ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šæ¸ˆã¿ + TRIAL/PAID ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼

ä¸»ãªä½¿ã„æ–¹ï¼š

1 æ—¥ã®ãƒ¡ã‚¤ãƒ³é£Ÿäº‹å›æ•°åˆ†ã®è¨˜éŒ²ãŒå®Œäº†ã™ã‚‹ï¼ˆè¨˜éŒ²å®Œäº†åˆ¤å®šãŒ trueï¼‰
ã€Œä»Šæ—¥ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’è¦‹ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™
â†’ æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆï¼ˆãªã‘ã‚Œã°ï¼‰ / å–å¾—ï¼ˆæ—¢ã«ã‚ã‚Œã°ï¼‰ã•ã‚Œã¦è¡¨ç¤ºã•ã‚Œã‚‹
å°†æ¥çš„ã«ã¯ï¼š

ã€Œå±¥æ­´ç”»é¢ã€ã§éå»ã®æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆä¸€è¦§ã‚’è¦‹ã‚Œã‚‹
ã€Œç›´è¿‘ 5 æ—¥åˆ†ã®ãƒ¬ãƒãƒ¼ãƒˆã€ãŒææ¡ˆæ©Ÿèƒ½ã®å‰æã«ãªã‚‹
2-2. ãƒ¬ãƒãƒ¼ãƒˆã«æœŸå¾…ã•ã‚Œã‚‹ UX
1 æ—¥ã®é£Ÿäº‹å‚¾å‘ã‚’ è‡ªç„¶è¨€èªã§è¦ç´„ï¼š

ã€Œã‚¿ãƒ³ãƒ‘ã‚¯è³ªã¯ç›®æ¨™ã«å¯¾ã—ã¦ååˆ†ï¼ä¸è¶³ã€
ã€Œè„‚è³ªãŒå¤šã‚ã€ã€Œé‡èœãŒå°‘ãªã‚ã€ãªã©
è¡Œå‹•ã«ã¤ãªãŒã‚‹ç®‡æ¡æ›¸ãï¼š

good_pointsï¼šã‚„ã£ã¦ã‚ˆã‹ã£ãŸã“ã¨ï¼ˆç¶™ç¶šã—ãŸã„ç¿’æ…£ï¼‰
improvement_pointsï¼šæ”¹å–„ã§ãã‚‹ãƒã‚¤ãƒ³ãƒˆ
tomorrow_focusï¼šæ˜æ—¥ã‚„ã‚‹å…·ä½“çš„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦–ç‚¹ã§ã¯ï¼š

ã€Œæ „é¤Šç´ ã®æ•°å­—ã€ã§ã¯ãªã **ã€Œä»Šæ—¥ã¯ã“ã“ãŒè‰¯ãã¦ã€ã“ã“ã‚’å¤‰ãˆã‚‹ã¨ã„ã„ã€**ãŒä¸€ç›®ã§åˆ†ã‹ã‚‹ã‚‚ã®ã€‚
2-3. API ä»•æ§˜ï¼ˆå¤–éƒ¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰
(1) POST /nutrition/daily/report
ç›®çš„ï¼šæŒ‡å®šæ—¥ã®æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚’ã€Œç”Ÿæˆã€ã™ã‚‹ã€‚

èªè¨¼ï¼šå¿…é ˆ

ãƒ—ãƒ©ãƒ³åˆ¶ç´„ï¼šTRIAL / PAID ã®ã¿ï¼ˆFREE ã¯ 403/402ï¼‰

ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ä¾‹ï¼š

{
"date": "2025-11-30"
}
å‰ææ¡ä»¶ï¼š

å¯¾è±¡æ—¥ãŒ è¨˜éŒ²å®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ï¼ˆDailyLogCompletion ãŒ trueï¼‰
(user_id, date) ã® DailyNutritionReport ãŒã¾ã å­˜åœ¨ã—ãªã„ã“ã¨
Profile ãŒå­˜åœ¨ã™ã‚‹ã“ã¨
æ „é¤Šè¨ˆç®—ãŒå¯èƒ½ãªãƒ—ãƒ©ãƒ³ï¼ˆTRIAL / PAIDï¼‰ã§ã‚ã‚‹ã“ã¨
æŒ¯ã‚‹èˆã„ï¼ˆã–ã£ãã‚Šï¼‰ï¼š

ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆuser_idï¼‰ã‚’å–å¾—

ãƒ—ãƒ©ãƒ³ãƒã‚§ãƒƒã‚¯ï¼ˆTRIAL / PAID ä»¥å¤–ãªã‚‰ã‚¨ãƒ©ãƒ¼ï¼‰

CheckDailyLogCompletionUseCase ã§ is_completed ã‚’ç¢ºèª

false â†’ DailyLogNotCompletedError â†’ 400
æ—¢å­˜ãƒ¬ãƒãƒ¼ãƒˆç¢ºèª

æ—¢ã«å­˜åœ¨ â†’ DailyNutritionReportAlreadyExistsError â†’ 409
Profile, TargetSnapshot/ActiveTarget, DailyNutritionSummary, MealNutritionSummary ã‚’æƒãˆã‚‹

LLM ãƒãƒ¼ãƒˆã‚’é€šã—ã¦ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

DailyNutritionReport ã¨ã—ã¦ä¿å­˜

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ã‚’è¿”ã™

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ï¼š

{
"date": "2025-11-30",
"summary": "ä»Šæ—¥ã¯ãŸã‚“ã±ãè³ªãŒç›®æ¨™ã‚’ååˆ†ã«æº€ãŸã—ã¤ã¤ã€è„‚è³ªã‚’æŠ‘ãˆãŸãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„é£Ÿäº‹ãŒã§ãã¦ã„ã¾ã™ã€‚",
"good_points": [
"æœé£Ÿãƒ»æ˜¼é£Ÿãƒ»å¤•é£Ÿãã‚Œãã‚Œã§ãŸã‚“ã±ãè³ªæºã‚’ç¢ºä¿ã§ãã¦ã„ã¾ã™ã€‚",
"é‡èœã‚„ç™ºé…µé£Ÿå“ã‹ã‚‰é£Ÿç‰©ç¹Šç¶­ã‚„ãƒ“ã‚¿ãƒŸãƒ³ãŒå–ã‚Œã¦ã„ã¾ã™ã€‚"
],
"improvement_points": [
"ã‚„ã‚„ç‚­æ°´åŒ–ç‰©ãŒå¤šã‚ãªã®ã§ã€å¤•é£Ÿã®ä¸»é£Ÿé‡ã‚’å°‘ã—æ¸›ã‚‰ã™ã¨ã‚ˆã‚Šè‰¯ã•ãã†ã§ã™ã€‚"
],
"tomorrow_focus": [
"æœé£Ÿã§ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ã‚„åµãªã©ã€ãŸã‚“ã±ãè³ªã‚’æ„è­˜ã—ã¦å–ã‚Šå…¥ã‚Œã‚‹ã€‚",
"æ°´åˆ†ã‚’ã“ã¾ã‚ã«æ‘‚ã‚Šã¤ã¤ã€é–“é£Ÿã¯ 1 æ—¥ 1 å›ã¾ã§ã«æŠ‘ãˆã‚‹ã€‚"
]
}
(2) GET /nutrition/daily/report?date=YYYY-MM-DD
ç›®çš„ï¼šæ—¢ã«ç”Ÿæˆæ¸ˆã¿ã®æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚’å–å¾—ã™ã‚‹ã€‚

èªè¨¼ï¼šå¿…é ˆ

ãƒ—ãƒ©ãƒ³åˆ¶ç´„ï¼š

TRIAL / PAIDï¼šè‡ªç”±ã«å–å¾—å¯èƒ½
FREEï¼šç†å±ˆã®ä¸Šã§ã¯ã€Œéå»ã« TRIAL / PAID ã®æœŸé–“ã«ç”Ÿæˆã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆã€ã‚’èª­ã‚€ã ã‘ãªã‚‰è¨±å¯ã—ã¦ã‚‚ã‚ˆã„
ï¼ˆå®Ÿè£…ä¸Šã¯ã€Œä½œæˆç¦æ­¢ã€ã§ååˆ†ï¼‰
æŒ¯ã‚‹èˆã„ï¼š

Repo ã‹ã‚‰ (user_id, date) ã«å¯¾å¿œã™ã‚‹ DailyNutritionReport ã‚’æ¢ã™
è¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã° 404
ã‚ã‚Œã°ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã™
2-4. ä»–æ©Ÿèƒ½ã‹ã‚‰è¦‹ãŸã€Œæ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆå¤–éƒ¨ä»•æ§˜ã€
ææ¡ˆæ©Ÿèƒ½ï¼ˆMealRecommendationï¼‰ã¯ï¼š

DailyNutritionReport ã‚’ ç›´è¿‘ 5 æ—¥åˆ†å–å¾—ã§ãã‚‹ã“ã¨ãŒå‰æã€‚
ç”Ÿæˆæ¸ˆã¿ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’èª­ã¿å–ã‚Šã€LLM ã®å…¥åŠ›ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã€‚
UI å´ï¼š

ã€Œãƒ¬ãƒãƒ¼ãƒˆã‚¿ãƒ–ã€ã‚„ã€Œå±¥æ­´ç”»é¢ã€ã§ GET /nutrition/daily/report ã‚’å©ã„ã¦è¡¨ç¤ºã™ã‚‹ã€‚
ã€Œä»Šæ—¥ã®ãƒ¬ãƒãƒ¼ãƒˆãŒæœªç”Ÿæˆã€ã§ã‚ã‚Œã°ã€POST /nutrition/daily/report ã‚’å©ã„ã¦ç”Ÿæˆ â†’ åŒæ™‚ã«è¡¨ç¤ºã™ã‚‹ã€‚ 3. å†…éƒ¨ä»•æ§˜ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ / UseCase / ãƒãƒ¼ãƒˆï¼‰
3-1. ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
Entity: DailyNutritionReport
æ—¢ã«æ±ºã‚ãŸé€šã‚Šï¼š

DailyNutritionReport(
id: DailyNutritionReportId,
user_id: UserId,
date: date,
summary: str,
good_points: list[str],
improvement_points: list[str],
tomorrow_focus: list[str],
created_at: datetime,
)
ä¸å¤‰æ¡ä»¶ï¼š

(user_id, date) ã§é«˜ã€… 1 ä»¶ã€‚
ç”Ÿæˆå¾Œã«ä¸­èº«ã‚’å®‰æ˜“ã«æ›¸ãæ›ãˆãªã„ï¼ˆå†ç”Ÿæˆã‚’è¨±ã™ãªã‚‰å°‚ç”¨ UC ã§æ‰±ã†ï¼‰ã€‚
ä¸»ãªã‚¨ãƒ©ãƒ¼ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ / ã‚¢ãƒ—ãƒªå±¤ã§åˆ©ç”¨ï¼‰
DailyLogNotCompletedError
â†’ è¨˜éŒ²ãŒå®Œäº†ã—ã¦ã„ãªã„ã®ã«ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã—ã‚ˆã†ã¨ã—ãŸå ´åˆã€‚
DailyNutritionReportAlreadyExistsError
â†’ æ—¢ã«åŒæ—¥ã®ãƒ¬ãƒãƒ¼ãƒˆãŒå­˜åœ¨ã™ã‚‹å ´åˆã€‚
3-2. Repository ãƒãƒ¼ãƒˆ
DailyNutritionReportRepositoryPort
class DailyNutritionReportRepositoryPort(Protocol):
def get_by_user_and_date(
self,
user_id: UserId,
target_date: date,
) -> DailyNutritionReport | None: ...

    def list_recent(
        self,
        user_id: UserId,
        limit: int,
    ) -> Sequence[DailyNutritionReport]: ...

    def save(self, report: DailyNutritionReport) -> None: ...

list_recent ã¯ææ¡ˆæ©Ÿèƒ½ã§ã€Œç›´è¿‘ 5 æ—¥åˆ†ã®ãƒ¬ãƒãƒ¼ãƒˆã€ã‚’å–å¾—ã™ã‚‹ã¨ãã«ä½¿ã†ã€‚
3-3. LLM ãƒãƒ¼ãƒˆï¼ˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼‰
DTO: DailyReportLLMInput / Output
@dataclass
class DailyReportLLMInput:
user_id: UserId
date: date
profile: Profile
target_snapshot: DailyTargetSnapshot # ã¾ãŸã¯å½“æ—¥ã® Active Target
daily_summary: DailyNutritionSummary
meal_summaries: list[MealNutritionSummary]

@dataclass
class DailyReportLLMOutput:
summary: str
good_points: list[str]
improvement_points: list[str]
tomorrow_focus: list[str]
Port: DailyNutritionReportGeneratorPort
class DailyNutritionReportGeneratorPort(Protocol):
def generate(self, input: DailyReportLLMInput) -> DailyReportLLMOutput:
...
å®Ÿè£…ï¼š

StubDailyNutritionReportGeneratorï¼šå›ºå®šæ–‡è¨€ or ç°¡æ˜“ãƒ­ã‚¸ãƒƒã‚¯
OpenAIDailyNutritionReportGeneratorï¼šOpenAI API ã«ã‚ˆã‚‹ LLM å®Ÿè£…ï¼ˆå°†æ¥ï¼‰
3-4. UseCaseï¼šGenerateDailyNutritionReportUseCase
è²¬å‹™

(user_id, date) ã«å¯¾ã—ã¦ã€Œè¨˜éŒ²å®Œäº† â†’ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå¯å¦ã‚’åˆ¤å®šã—ã€å¿…è¦ãªã‚‰ LLM ã‚’å›ã—ã¦ Report ã‚’ç”Ÿæˆãƒ»ä¿å­˜ã™ã‚‹ã€ã€‚
å…¥åŠ›

user_id: UserId
date: date
ä¾å­˜ï¼ˆä¸»ãªãƒãƒ¼ãƒˆ / UCï¼‰

CheckDailyLogCompletionUseCase
ProfileRepositoryPort
EnsureDailyTargetSnapshotUseCaseï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ç”¨æ„ã™ã‚‹ UCï¼‰
ComputeDailyNutritionSummaryUseCase
MealNutritionSummaryRepositoryPort
DailyNutritionReportRepositoryPort
DailyNutritionReportGeneratorPortï¼ˆLLMï¼‰
ClockPort +ï¼ˆå¿…è¦ãªã‚‰ï¼‰ãƒ—ãƒ©ãƒ³åˆ¤å®šã®ãŸã‚ã® UserRepository / PlanChecker
å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆè«–ç†ï¼‰

ãƒ—ãƒ©ãƒ³ãƒã‚§ãƒƒã‚¯

User ã‚’å–å¾—ã—ã€plan in {TRIAL, PAID} ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã€‚
ãã‚Œä»¥å¤– â†’ ã‚¨ãƒ©ãƒ¼ï¼ˆHTTP å±¤ã§ 403/402ï¼‰ã€‚
è¨˜éŒ²å®Œäº†ãƒã‚§ãƒƒã‚¯

completion = CheckDailyLogCompletionUseCase.execute(user_id, date)
completion.is_completed ãŒ False â†’ DailyLogNotCompletedError
æ—¢å­˜ãƒ¬ãƒãƒ¼ãƒˆæœ‰ç„¡ã®ç¢ºèª

existing = report_repo.get_by_user_and_date(user_id, date)
existing ãŒã‚ã‚Œã° â†’ DailyNutritionReportAlreadyExistsError
Profile å–å¾—

profile_repo.get_by_user_id(user_id)
ãªã‘ã‚Œã° â†’ ProfileNotFound çš„ãªã‚¨ãƒ©ãƒ¼
ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå–å¾—

EnsureDailyTargetSnapshotUseCase.execute(user_id, date) ã‚’å‘¼ã¶ï¼š

éå»æ—¥ â†’ DailyTargetSnapshot
å½“æ—¥ â†’ Active Target ã‹ã‚‰ Snapshot çš„ã«æ‰±ã†ï¼ˆå®Ÿè£…æ¬¡ç¬¬ï¼‰
æˆ»ã‚Šå€¤ã‚’ target_snapshot ã¨ã—ã¦ LLM å…¥åŠ›ã«ä½¿ã†ã€‚

1 æ—¥åˆ†ã®æ „é¤Šã‚µãƒãƒªå–å¾— / å†è¨ˆç®—

daily = ComputeDailyNutritionSummaryUseCase.execute(user_id, date)
ã“ã‚Œã«ã‚ˆã‚Šã€ãã®æ—¥ã® DailyNutritionSummary ãŒæœ€æ–°çŠ¶æ…‹ã«ãªã‚‹ã€‚
1 æ—¥ã¶ã‚“ã® MealNutrition ä¸€è¦§å–å¾—

meal_summaries = meal_nutrition_repo.list_by_user_and_date(user_id, date)
LLM å…¥åŠ› DTO ã®çµ„ã¿ç«‹ã¦ & ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

llm_input = DailyReportLLMInput(...)
llm_output = report_generator.generate(llm_input)
DailyNutritionReport ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ç”Ÿæˆ

created_at = clock.now()
DailyNutritionReport.create(...) ã§ Entity ã‚’ä½œã‚‹ã€‚
ä¿å­˜ & æˆ»ã‚Šå€¤

report_repo.save(report)
UseCase ã®æˆ»ã‚Šå€¤ã¨ã—ã¦ report ã‚’è¿”ã™ã€‚
3-5. ãƒ¬ãƒãƒ¼ãƒˆå–å¾— UseCaseï¼ˆè£œè¶³ï¼‰
GetDailyNutritionReportUseCase

execute(user_id, date) â†’ Report or None
ListDailyNutritionReportsUseCase

execute(user_id, limit, from/to) â†’ æœ€è¿‘ N ä»¶ãªã©
API å´ã§ã¯ã“ã‚Œã‚’å©ã„ã¦ GET /nutrition/daily/report ã‚„å°†æ¥ã®ä¸€è¦§ API ã‚’æä¾›ã™ã‚‹ã€‚

4. ã¾ã¨ã‚ï¼ˆæ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã®ã‚­ãƒ¢ï¼‰
   ä½•ã‚’ã—ã¦ã„ã‚‹ã‹

ã€Œä»Šæ—¥ã®é£Ÿäº‹ãƒ­ã‚°ã€ã¨ã€Œæ „é¤Šã®æ•°å­—ã€ã¨ã€Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆã€ã‚’ææ–™ã«ã€
LLM ã‚’ä½¿ã£ã¦ â€œ1 æ—¥ã®æ „é¤Šã«é–¢ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ–‡ç« â€ ã‚’ä½œã£ã¦ä¿å­˜ã—ã¦ã„ã‚‹ã€‚
ã„ã¤ä½œã‚Œã‚‹ã‹

è¨˜éŒ²å®Œäº†ï¼ˆmain ã®é£Ÿäº‹å›æ•°åˆ†ãŒåŸ‹ã¾ã£ã¦ã„ã‚‹ï¼‰ï¼‹ TRIAL/PAID ãƒ—ãƒ©ãƒ³ã®ã¨ãã®ã¿ã€‚
åŒã˜æ—¥ã«ã¯æœ€å¤§ 1 å›ï¼ˆå†ç”Ÿæˆã™ã‚‹ãªã‚‰åˆ¥é€”ãƒ«ãƒ¼ãƒ«ãŒå¿…è¦ï¼‰ã€‚
ä½•ã«ä½¿ã‚ã‚Œã‚‹ã‹

ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®æŒ¯ã‚Šè¿”ã‚Šç”»é¢
ææ¡ˆæ©Ÿèƒ½ï¼ˆç›´è¿‘ 5 æ—¥åˆ†ãƒ¬ãƒãƒ¼ãƒˆã‚’å…¥åŠ›ã«ã™ã‚‹ï¼‰
å°†æ¥ã®ãƒãƒƒã‚¸ï¼ˆã€Œãƒ¬ãƒãƒ¼ãƒˆã‚’ â—¯ æ—¥é€£ç¶šã§ç”Ÿæˆã€ãªã©ï¼‰
ãªãœ Daily ã§æŒã¤ã‹

FoodEntry / Meal / Daily ã®ã€Œæ•°å­—ã€ã ã‘ã ã¨ä¼ã‚ã‚Šã¥ã‚‰ã„ã‚‚ã®ã‚’ã€
ã€Œè¨€è‘‰ã€ã§æ•´ç†ã—ã¦ã‚ã’ã‚‹â€œæ„å‘³ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼â€ã¨ã—ã¦ã®å½¹å‰²ã‚’æ‹…ã£ã¦ã„ã‚‹ã€‚
ã“ã®ä»•æ§˜ã‚’å‰æã«ã—ã¦ãŠã‘ã°ã€
ã‚ã¨ã¯ LLM ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ ã‚„ UI ãƒ‡ã‚¶ã‚¤ãƒ³ ã‚’ä¹—ã›ã¦ã„ãã ã‘ã§ã€
ã‹ãªã‚Šãƒªãƒƒãƒãªã€Œ1 æ—¥ã®æŒ¯ã‚Šè¿”ã‚Šä½“é¨“ã€ãŒä½œã‚Œã‚‹ã¯ãšã§ã™ ğŸ’¡
